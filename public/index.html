<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>长图自动分割</title>

    <!-- bootstrap 4.x is supported. You can also use the bootstrap css 3.3.x versions -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.4.5/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
    <!-- if using RTL (Right-To-Left) orientation, load the RTL CSS file after fileinput.css by uncommenting below -->
    <!-- link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.4.5/css/fileinput-rtl.min.css" media="all" rel="stylesheet" type="text/css" /-->
    <!-- optionally uncomment line below if using a theme or icon set like font awesome (note that default icons used are glyphicons and `fa` theme can override it) -->
    <!-- link https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css media="all" rel="stylesheet" type="text/css" /-->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!-- piexif.min.js is only needed for restoring exif data in resized images and when you
        wish to resize images before upload. This must be loaded before fileinput.min.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.4.5/js/plugins/piexif.min.js" type="text/javascript"></script>
    <!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview.
        This must be loaded before fileinput.min.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.4.5/js/plugins/sortable.min.js" type="text/javascript"></script>
    <!-- purify.min.js is only needed if you wish to purify HTML content in your preview for
        HTML files. This must be loaded before fileinput.min.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.4.5/js/plugins/purify.min.js" type="text/javascript"></script>
    <!-- popper.min.js below is needed if you use bootstrap 4.x. You can also use the bootstrap js
       3.3.x versions without popper.min.js. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <!-- bootstrap.min.js below is needed if you wish to zoom and preview file content in a detail modal
        dialog. bootstrap 4.x is supported. You can also use the bootstrap js 3.3.x versions. -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" type="text/javascript"></script>
    <!-- the main fileinput plugin file -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.4.5/js/fileinput.min.js"></script>
    <!-- optionally uncomment line below for loading your theme assets for a theme like Font Awesome (`fa`) -->
    <!-- script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.4.5/themes/fa/theme.min.js"></script -->
    <!-- optionally if you need translation for your language then include  locale file as mentioned below -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.4.5/js/locales/LANG.js"></script>

</head>
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<style type="text/css">
    #preview {
        padding-top: 20px;
        padding-bottom: 5px;
        padding-left: 5px;
    }
    .msg {
        display: none;
        padding-top: 20px;
        padding-bottom: 5px;
        padding-left: 5px;
    }
    #clear-btn {
        position: absolute;
        opacity: 0;
        top: 5px;
        right: 10px;
        width: 24px;
        height: 24px;
        cursor: pointer;
        color: #66AFE9;
    }
    @media (max-width: 768px) {
        #container {
            padding-top: 15px;
            padding-left: 5px;
            padding-right: 5px;
        }
        #inputer button {
            width: 100%;
        }
    }
    @media (min-width: 768px) {
        #inputer {
            padding: 30px 30px 30px 30px;
            border-bottom: 1px solid lightgray;
        }
        #inputer input {
            width: 500px;
        }
        #inputer button {
            width: 100px;
        }
        #preview {
            padding: 30px 30px 30px 30px;
        }
    }
</style>
<body>
<div id="container">
    <form id="inputer" class="form-inline" action="${ctx}/save?callbackType=confirmTimeoutForward" enctype="multipart/form-data">
        <div class="form-group" style="position: relative">

            <input id="input-id" type="file" class="file" data-preview-file-type="text">

        </div>
    </form>
    <div class="msg">正在提取……</div>
    <div class="center-block" id="preview" style="display: none;">
        <p>av号：<span></span></p>
        <p>图片链接：<a></a></p>
        <p>图片预览：</p>
        <a href="#" class="thumbnail">
            <img alt="预览图" />
        </a>
    </div>
</div>
</body>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            $("#input-id").fileinput();
        });
        var $inputer = $('#inputer');
        var $preview = $('#preview');
        var $msg = $('.msg');
        $inputer.find('button').click(function () {
            var value = $inputer.find('input').val();
            if (!value) return alert('请先输入av号/视频链接');
            $preview.hide();
            $preview.find('img').attr('src', 'https://icons8.com/preloaders/preloaders/733/Thin%2012%20segments.gif');
            $msg.show();
            $.get('/pick', {key: value}, function (response, status) {
                if (!status) alert('请求结果失败');
                if (response.Code === 0) {
                    var coverUrl = response.Data.coverUrl;
                    var avid = response.Data.avid;
                    $preview.find('p>span').text(avid);
                    $preview.find('p>a').attr('href', coverUrl);
                    $preview.find('p>a').text(coverUrl);
                    //$preview.find('img').attr('src', '/imgpipe?src=' + coverUrl + '@480w_300h.jpg');
                    //$preview.children('a').attr('href', '/img?src=' + 'http://' + location.host + '/imgpipe?src=' + coverUrl);
                    $preview.find('img').attr('src', coverUrl);
                    $preview.children('a').attr('href', coverUrl);
                    $msg.hide();
                    $preview.show();
                } else {
                    alert('解析结果失败');
                }
            });
        });
        var $clear = $('#clear-btn');
        var $input = $inputer.find('input');
        $input.keyup(function (e) {
            if (e.which === 13) $inputer.find('button').click();
            else {
                if ($input.val().length > 0) $clear.css('opacity', 1);
                else $clear.css('opacity', 0);
            }
        });
        $input.blur(function () {
            $clear.css('opacity', 0);
        });
        $input.focus(function () {
            if ($input.val().length > 0) $clear.css('opacity', 1);
        });
        $clear.click(function () {
            $input.val("");
        })
    })($);
</script>
</html>